@using Phoenix.Services
@inject Phoenix.Services.IBTProjectService projectService
@inject Microsoft.AspNetCore.Identity.UserManager<BTUser> _userManager
@model Phoenix.Models.ViewModels.DashboardViewModel 
@*@inject IBTTicketService ticketService*@
@inject IBTRoleService roleService

@{
    ViewData["Title"] = "Dashboard";
    var user = await _userManager.GetUserAsync(User);
    var userId = _userManager.GetUserId(User);
    var roles = await roleService.ListUserRolesAsync(user);
    string roleName = "";
    foreach (var role in roles)
    {
        if (role != "Demo")
        {
            roleName = role;
        }
    }

}
<div class="row layout-top-spacing">



    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
        <div class="row widget-statistic">
            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12">
                <div class="widget widget-one_hybrid widget-referral">
                    <div class="widget-heading">
                        <div class="w-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                        </div>
                        <p class="w-value">@Model.Tickets.Where(t => t.TicketPriority.Name == "Urgent").Count()</p>
                        <h5 class="">Critical Tickets</h5>
                    </div>
                   
                </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12">
                <div class="widget widget-one_hybrid widget-followers">
                    <div class="widget-heading">
                        <div class="w-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        </div>
                        <p class="w-value">@Model.Tickets.Where(t => t.DeveloperUser == null).Count()</p>
                        <h5 class="">Unassigned Tickets</h5>
                    </div>
                
                </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12">
                <div class="widget widget-one_hybrid widget-engagement">
                    <div class="widget-heading">
                        <div class="w-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                        </div>
                        <p class="w-value">@Model.Tickets.Where(t => t.TicketStatus.Name == "New").Count()</p>
                        <h5 class="">New Tickets</h5>
                    </div>
           
                </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12">
                <div class="widget widget-one_hybrid widget-new">
                    <div class="widget-heading">
                        <div class="w-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                        </div>
                        <p class="w-value">@Model.Tickets.Where(t => t.TicketStatus.Name == "Closed").Count()</p>
                        <h5 class="">Resolved Tickets</h5>
                    </div>
                 
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <canvas id="myChart3" width="400" height="400"></canvas>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <canvas id="myChart" width="400" height="400"></canvas>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <canvas id="myChart2" width="400" height="400"></canvas>
        </div>
    </div>





    <!--<div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
        <div class="widget widget-activity-three">

            <div class="widget-heading">
                <h5 class="">Notifications</h5>
            </div>

            <div class="widget-content">

                <div class="mt-container mx-auto">
                    <div class="timeline-line">

                        <div class="item-timeline timeline-new">
                            <div class="t-dot">
                                <div class="t-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg></div>
                            </div>
                            <div class="t-content">
                                <div class="t-uppercontent">
                                    <h5>Logs</h5>
                                    <span class="">27 Feb, 2020</span>
                                </div>
                                <p><span>Updated</span> Server Logs</p>
                                <div class="tags">
                                    <div class="badge badge-primary">Logs</div>
                                    <div class="badge badge-success">CPanel</div>
                                    <div class="badge badge-warning">Update</div>
                                </div>
                            </div>
                        </div>

                        <div class="item-timeline timeline-new">
                            <div class="t-dot">
                                <div class="t-success"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></div>
                            </div>
                            <div class="t-content">
                                <div class="t-uppercontent">
                                    <h5>Mail</h5>
                                    <span class="">28 Feb, 2020</span>
                                </div>
                                <p>Send Mail to <a href="javascript:void(0);">HR</a> and <a href="javascript:void(0);">Admin</a></p>
                                <div class="tags">
                                    <div class="badge badge-primary">Admin</div>
                                    <div class="badge badge-success">HR</div>
                                    <div class="badge badge-warning">Mail</div>
                                </div>
                            </div>
                        </div>

                        <div class="item-timeline timeline-new">
                            <div class="t-dot">
                                <div class="t-danger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg></div>
                            </div>
                            <div class="t-content">
                                <div class="t-uppercontent">
                                    <h5>Task Completed</h5>
                                    <span class="">01 Mar, 2020</span>
                                </div>
                                <p>Backup <span>Files EOD</span></p>
                                <div class="tags">
                                    <div class="badge badge-primary">Backup</div>
                                    <div class="badge badge-success">EOD</div>
                                </div>
                            </div>
                        </div>

                        <div class="item-timeline timeline-new">
                            <div class="t-dot">
                                <div class="t-warning"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div>
                            </div>
                            <div class="t-content">
                                <div class="t-uppercontent">
                                    <h5>Collect Docs</h5>
                                    <span class="">10 Mar, 2020</span>
                                </div>
                                <p>Collected documents from <a href="javascript:void(0);">Sara</a></p>
                                <div class="tags">
                                    <div class="badge badge-success">Collect</div>
                                    <div class="badge badge-warning">Docs</div>
                                </div>
                            </div>
                        </div>

                        <div class="item-timeline timeline-new">
                            <div class="t-dot">
                                <div class="t-dark"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-server"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6" y2="6"></line><line x1="6" y1="18" x2="6" y2="18"></line></svg></div>
                            </div>
                            <div class="t-content">
                                <div class="t-uppercontent">
                                    <h5>Reboot</h5>
                                    <span class="">06 Apr, 2020</span>
                                </div>
                                <p>Server rebooted successfully</p>
                                <div class="tags">
                                    <div class="badge badge-warning">Reboot</div>
                                    <div class="badge badge-primary">Server</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>-->

    
    @*<div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-12 layout-spacing">
        <div class="widget widget-five">
            <div class="widget-content">

                <div class="header">
                    <div class="header-body">
                        <h6>Pending Tasks</h6>
                        <p class="meta-date">Nov 2019</p>
                    </div>
                    <div class="task-action">
                        <div class="dropdown  custom-dropdown">
                            <a class="dropdown-toggle" href="#" role="button" id="pendingTask" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
                            </a>

                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="pendingTask">
                                <a class="dropdown-item" href="javascript:void(0);">Add</a>
                                <a class="dropdown-item" href="javascript:void(0);">View</a>
                                <a class="dropdown-item" href="javascript:void(0);">Update</a>
                                <a class="dropdown-item" href="javascript:void(0);">Clear All</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-content">
                    <div class="">
                        <p class="task-left">8</p>
                        <p class="task-completed"><span>12 Done</span></p>
                        <p class="task-hight-priority"><span>3 Task</span> with High priotity</p>
                    </div>
                </div>
            </div>
        </div>

    </div>*@

  

</div>
    @*Footer*@
    <div class="footer-wrapper">
        <div class="footer-section f-section-1">
            <p class="">Copyright © 2021 <a target="_blank" href="https://designreset.com">Phoenix Issue Tracker</a>, All rights reserved.</p>
        </div>
        <div class="footer-section f-section-2">
            <p class="">Coded with <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></p>
        </div>
    </div>

    @section Scripts {
        <script src="//cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>

       @*Chart 1 Bar Chart*@
<script>
           var Url3 = '@Url.Action("StatusChart", "Charts")';
             $.post(Url3).then(function (response) {
                 var ctx = document.getElementById('myChart').getContext('2d');
                 var barChartData = {
                     labels: response.labels,
                     datasets: [{
                         label: 'Tickets By Status',
                         data: response.data,
                         backgroundColor: response.backgroundColors,
                         hoverOffset: 4
                     }]
                 };
                 var myChart = new Chart(ctx, {
                     type: 'bar',
                     data: barChartData                   
                })
                //options: {
                //    scales: {
                //        yAxes: [{
                //            ticks: {
                //                beginAtZero: true
                //            }
                //        }]
                //    }
                //}

            });
</script>

       @*Chart 2 PolarArea Chart*@
<script>
            var Url2 = '@Url.Action("TypeChart", "Charts")';
             $.post(Url2).then(function (response) {
             var ctx = document.getElementById('myChart2').getContext('2d');
                 var polarChartData = {
                     labels: response.labels,
                     datasets: [{
                         label: 'Tickets By Type',
                         data: response.data,
                         backgroundColor: response.backgroundColors,
                         hoverOffset: 4
                     }]
                 };
                 var myChart2 = new Chart(ctx,
                     {
                         type: 'polarArea',
                         data: polarChartData
                     })
                 });
</script>

         @*Chart 3 Doughnut Chart*@
        <script>
            //Step 1 generate the Url that we will call to get JSON
            var Url1 = '@Url.Action("PriorityChart", "Charts")'; //represents the endpoint ( action + controller) that we want to hit

            //Step 2 start the structure for our AJAX call
            $.post(Url1).then(function (response) {
                //Get the context/canvas for the chart
                var ctx = document.getElementById('myChart3').getContext('2d');
                //Use The JSON response to create the data property of the chart
                var doughnutChartData = {
                    labels: response.labels,
                    datasets: [{
                        label: 'Tickets By Priority',
                        data: response.data,
                        backgroundColor: response.backgroundColors,
                        hoverOffset: 4
                    }]
                };
                var myChart3 = new Chart(ctx, {
                    type: 'doughnut',
                    data: doughnutChartData
                })
            });
         </script>

    }
